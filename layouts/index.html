{{ define "main" }}
<div class="homepage">
    <section class="intro">
        <p>Thinking about everything all the time.</p>
    </section>

    <section class="category-previews">
        {{ $categories := slice "opinion" "art-culture" "reviews" "diary" }}
        {{ range $categories }}
            {{ $categoryPages := where $.Site.Pages "Section" "posts" }}
            {{ $categoryPages = where $categoryPages ".Params.categories" "intersect" (slice .) }}
            {{ $latestPost := first 1 $categoryPages }}
            
            {{ if $latestPost }}
            <div class="category-section">
                {{ range $latestPost }}
                <div class="post-preview">
                    <h3>
                        <a href="{{ .RelPermalink }}">{{ .Title }}</a>
                        <span class="category-tag">{{ index .Params.categories 0 }}</span>
                    </h3>
                    {{ if and .Params.series .Params.series_number }}
                    <p class="series-info">This post is part {{ .Params.series_number }} of the series {{ .Params.series }}.</p>
                    {{ end }}
                    <div class="post-date">{{ .Date.Format "January 2, 2006" }}</div>
                    {{ if .Summary }}
                    <p class="post-excerpt">{{ .Summary | plainify | truncate 400 }}</p>
                    {{ end }}
                </div>
                {{ end }}
            </div>
            {{ end }}
        {{ end }}
    </section>


</div>
{{ end }}